# cakephp-entities-logger

[![Software License](https://img.shields.io/badge/license-MIT-brightgreen.svg?style=flat-square)](LICENSE.txt)
[![CI](https://github.com/mirko-pagliai/cakephp-entities-logger/actions/workflows/ci.yml/badge.svg)](https://github.com/mirko-pagliai/cakephp-entities-logger/actions/workflows/ci.yml)
[![codecov](https://codecov.io/gh/mirko-pagliai/cakephp-entities-logger/graph/badge.svg?token=9yi4NCAADl)](https://codecov.io/gh/mirko-pagliai/cakephp-entities-logger)
[![Codacy Badge](https://app.codacy.com/project/badge/Grade/79152e0bd07a47c58daecd04aa6bc225)](https://app.codacy.com/gh/mirko-pagliai/cakephp-entities-logger/dashboard?utm_source=gh&utm_medium=referral&utm_content=&utm_campaign=Badge_grade)
[![CodeFactor](https://www.codefactor.io/repository/github/mirko-pagliai/cakephp-entities-logger/badge)](https://www.codefactor.io/repository/github/mirko-pagliai/cakephp-entities-logger)
[![CodeFactor](https://www.codefactor.io/repository/github/mirko-pagliai/cakephp-essentials/badge)](https://www.codefactor.io/repository/github/mirko-pagliai/cakephp-essentials)

![screenshot_phpmyadmin.png](docs/screenshot_phpmyadmin.png)

From this screenshot, which shows the table seen by PhpMyAdmin, we see the logs generated by two different entities,
created, modified or deleted by different users.

## Installation
You can install the plugin via composer:
```bash
composer require --prefer-dist mirko-pagliai/cakephp-entities-logger
```

Then you have to load the plugin. For more information on how to load the plugin,
please refer to the [CakePHP documentation](https://book.cakephp.org/5/en/plugins.html#loading-a-plugin).

Simply, you can execute the shell command to enable the plugin:
```bash
bin/cake plugin load Cake/EntitiesLogger
```
This would update your application's bootstrap method.

## Create the table
Now you need to create the table that the plugin will use to keep changes to the entities you want.

The best way is using migrations:
```bash
bin/cake migrations migrate -p Cake/EntitiesLogger
```

Instead, if you want to verify that the plugin migrations have been applied correctly:
```bash
bin/cake migrations status -p Cake/EntitiesLogger
```

## Add the behavior

Add the `Cake/EntitiesLogger.EntitiesLog` behavior to the tables you want.

Inside the `initialize()` method of your tables:
```php
namespace App\Model\Table;

use Cake\ORM\Table;

class ArticlesTable extends Table
{
    public function initialize(array $config): void
    {
        // ...
        
        $this->addBehavior('Cake/EntitiesLogger.EntitiesLog');
        
        // ...
    }
}
```